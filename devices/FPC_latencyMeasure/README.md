![Alt text](Docs/latencyMeasure_sch.png?raw=true&=200x "FPC_latencyMeasure")
## FPC_latencyMeasure
This is a small circuit designed to measure the latency time of an FPV video system. In particular, this device is designed to measure the so-called "glass to glass" latency, the time that passes from when the image is sampled by the camera to when it is displayed on the screen. It is important to keep the latency low on the FPV systems because it introduces a delay between the command given to the vehicle and the sight of the effect that the command has produced, this greatly affects the maneuverability of, for example, a drone or an airplane. 
Latency depends on many technical factors and in particular the type of technology. In the case of analog systems, the latency is very low, generally in the order of a few tens of milliseconds and has very little influence on the flight. In the case of digital systems, the latency increases considerably due to the greater complexity of the system and except for systems designed ad-hoc (see dji) it ranges from about 100ms up to several seconds. In the case of digital, the factors that influence it the most are the following: image resolution, sampling and compression time, any processing on the image such as the rotation, the connection speed and type of protocol used, the decompression and display time.
It is therefore evident the need to perform a precise measurement of latency. This very simple circuit is able to measure latency, measuring the time between when a LED is turned on and when the LED light appears on the screen, detected by a photoelectric sensor. A few components and an Arduino nano board are required to assemble the circuit, which manages the LED and measures of the time.
The idea is not mine and it is not new, it has been widely described on the internet by other enthusiasts such as CurryKitten or Oscar Liang, my aim is only to simplify the life of those who want to make a similar device and do not know where to start. 
My board is slightly different from the others on the internet, I decided to use a transistor to switch an Arduino input configured as a hardware interrupt. This allows to have a more precise signal and reduce the latency of the system itself.
The latency that this card introduces is slightly variable and depends mainly on the amount of light that is directed to the photoresistor and is in the order of a few hundred microseconds. To subtract this introduced latency, simply press the button for more than 3 seconds, this measurement will be treated by the fw as an offset to be subtracted from the measurement. If you want to increase or decrease the sensitivity of the photoresistor it is possible to change the resistance R1 (increasing the value of R1 the photoresistor becomes more sensitive).
To use the board it is necessary to program the arduino with the FW present in this repository.
After programming the microcontroller it is necessary to open a serial terminal at the speed of 9600bps. The first thing to do is the system latency measurement. Pressing the button for more than 3 sencodes cause the offest measure the value is shown on the terminal windows, the "offset:" message will appear followed by latency expressed in microseconds. 
At this point it is possible to measure the latency of your FPV system, positioning the LEDs in front of the camera and the photoresistor in front of the screen where the LED is displayed. My advice is not to completely isolate the camera, but simply place the LED in the center rather close to the glass. On the other hand, the photocell should be isolated so that it intervenes as soon as possible when the brightness of the pixels changes. This insulation can be simply done by inserting the photoresistor inside a piece of black foam. 
After having correctly positioned the LED and the photoresistor, simply press the button quickly to perform a latency measurement and see the output on the terminal. 
The firmware does not perform any processing on the measured data, it simply returns the time elapsed from when the LED turned on to when the interrupt from the photoresistor arrived. It might make sense to add a few lines of code to make a certain number of samples in a random sequence and average them to get a more precise measurement.